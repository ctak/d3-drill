<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Line chart</title>
    <rel>https://observablehq.com/@d3/candlestick-chart/2</rel>
    <!-- <script type="text/javascript" src="../d3.js"></script> -->
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"
      integrity="sha512-M7nHCiNUOwFt6Us3r8alutZLm9qMt4s9951uo8jqO4UwJ1hziseL6O3ndFyigx6+LREfZqnhHxYjKRJ8ZQ69DQ=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <style type="text/css">
      .area {
        fill: teal;
        stroke: none;
      }

      .line {
        fill: none;
        stroke: teal;
        stroke-width: 0.5;
      }

      .safeLevel {
        stroke: red;
        stroke-dasharray: 2, 3;
      }

      .danger {
        /* stroke: red; */
        fill: red;
      }

      .dangerLabel {
        font-family: Helvetica, sans-serif;
        font-size: 12px;
        fill: red;
      }
    </style>
  </head>

  <body>
    <script>
      // Declare the chart dimensions and margins.
      const width = 928;
      const height = 600;
      const marginTop = 20;
      const marginRight = 30;
      const marginBottom = 30;
      const marginLeft = 40;

      function rowConverter(d) {
        return {
          // ...d,
          date: Date.parse(d.Date), // 결국 date 도 숫자니까.
          open: parseFloat(d.Open),
          close: parseFloat(d.Close),
          high: parseFloat(d.High),
          low: parseFloat(d.Low),
        }
      }

      d3.csv('./aapl-2.csv', rowConverter).then(data => {
        const ticker = data.slice(-120);
        // console.table(ticker)

        // Declare the positional encodings.
        // Date.getUTCDay() 의 local 은 Date.prototype.getDay() 임. 0-6: Sunday-Saturday
        const x = d3.scaleBand()
          .domain(d3.utcDay
            .range(ticker.at(0).date, +ticker.at(-1).date + 1)
            .filter(d => d.getUTCDay() !== 0 && d.getUTCDay() !== 6))
          .range([marginLeft, width - marginRight])
          .padding(0.2);

        const y = d3.scaleLog()
          .domain([d3.min(ticker, d => d.low), d3.max(ticker, d => d.high)])
          .rangeRound([height - marginBottom, marginTop]);

        // Create the SVG container.
        const svg = d3.select('body').append('svg')
          .attr('viewBox', [0, 0, width, height]);

        // Append the axes.
        svg.append('g')
          .attr('transform', `translate(0, ${height - marginBottom})`)
          .call(d3.axisBottom(x)
            .tickValues(d3.utcMonday
              .every(width > 720 ? 1 : 2)
              .range(ticker.at(0).date, ticker.at(-1).date))
            .tickFormat(d3.utcFormat('%-m/%-d')))
          .call(g => g.select('.domain').remove());




      });

    </script>
  </body>
</html>
